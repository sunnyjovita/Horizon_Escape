<html>
    <head>
    <title>Horizon Escapes</title>

    <script src="https://cdn.babylonjs.com/babylon.max.js"></script>
    <script src="https://cdn.babylonjs.com/babylon.js"></script>
    <script src="https://cdn.babylonjs.com/loaders/babylonjs.loaders.min.js"></script>
    <script src="https://cdn.babylonjs.com/gui/babylon.gui.js"></script>
    <script src="https://cdn.babylonjs.com/gui/babylon.gui.min.js"></script>
    <style>
        html, body {
        overflow: hidden;
        width: 100%;
        height: 100%;
        margin: 0;
        padding: 0;
        }
        #render {
        width: 100%;
        height: 100%;
        touch-action: none;
        }
    </style>
    </head>
    <body>
        <canvas id="render" touch-action="none">
        <script>
        var canvas = document.getElementById("render");
        var engine = new BABYLON.Engine(canvas, true);

        var createScene = function () {
            var scene = new BABYLON.Scene(engine);

            // This creates and positions a free camera (non-mesh)
            var camera = new BABYLON.FreeCamera("camera1", new BABYLON.Vector3(0, 5, -10), scene);

            // This targets the camera to scene origin
            camera.setTarget(BABYLON.Vector3.Zero());

            // This attaches the camera to the canvas
            camera.attachControl(canvas, true);

            // This creates a light, aiming 0,1,0 - to the sky (non-mesh)
            var light = new BABYLON.HemisphericLight("light", new BABYLON.Vector3(0, 1, 0), scene);

            // Default intensity is 1. Let's dim the light a small amount
            light.intensity = 0.7;

            // Our built-in 'sphere' shape.
            var sphere = BABYLON.MeshBuilder.CreateSphere("sphere", {diameter: 2, segments: 32}, scene);

            // Move the sphere upward 1/2 its height
            sphere.position.y = 1;

            // Our built-in 'ground' shape.
            var ground = BABYLON.MeshBuilder.CreateGround("ground", {width: 6, height: 100}, scene);
            
            var a = 0; // Starting point
            scene.registerBeforeRender(function () {
                a +=0.005;
                var sign = Math.cos(a)/Math.abs(Math.cos(a));
                sphere.position.z += 0.1;
            });

            // Keyboard input
            scene.actionManager = new BABYLON.ActionManager(scene);
            scene.actionManager.registerAction(new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnKeyDownTrigger, (evt) => {
                if (evt.sourceEvent.key == "a") {
                    sphere.__A_Pressed = true;
                }
            }));

            scene.actionManager.registerAction(new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnKeyUpTrigger, (evt) => {
                if (evt.sourceEvent.key == "a") {
                    sphere.__A_Pressed = false;
                }
            }));

            scene.actionManager.registerAction(new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnKeyDownTrigger, (evt) => {
                if (evt.sourceEvent.key == "d") {
                    sphere.__D_Pressed = true;
                }
            }));

            scene.actionManager.registerAction(new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnKeyUpTrigger, (evt) => {
                if (evt.sourceEvent.key == "d") {
                    sphere.__D_Pressed = false;
                }
            }));

            scene.actionManager.registerAction(new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnKeyDownTrigger, (evt) => {
                if (evt.sourceEvent.key == "w") {
                    sphere.__W_Pressed = true;
                }
            }));

            scene.actionManager.registerAction(new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnKeyUpTrigger, (evt) => {
                if (evt.sourceEvent.key == "w") {
                    sphere.__W_Pressed = false;
                }
            }));

            scene.actionManager.registerAction(new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnKeyDownTrigger, (evt) => {
                if (evt.sourceEvent.key == "s") {
                    sphere.__S_Pressed = true;
                }
            }));

            scene.actionManager.registerAction(new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnKeyUpTrigger, (evt) => {
                if (evt.sourceEvent.key == "s") {
                    sphere.__S_Pressed = false;
                }
            }));

            scene.registerBeforeRender(function(){
                if(!scene.isReady()) return;

                if(sphere){
                    // Left
                    if(sphere.__A_Pressed){
                        sphere.translate(BABYLON.Axis.X, -0.1, BABYLON.Space.LOCAL);
                    }
                    // Right
                    else if(sphere.__D_Pressed){
                        sphere.translate(BABYLON.Axis.X, 0.1, BABYLON.Space.LOCAL);
                    }
                    // Up
                    else if(sphere.__W_Pressed){
                        sphere.translate(BABYLON.Axis.Y, 0.1, BABYLON.Space.LOCAL);
                    }
                    // Down
                    else if(sphere.__S_Pressed){
                        sphere.translate(BABYLON.Axis.Y, -0.1, BABYLON.Space.LOCAL);
                    }
                }
            });

            return scene;
        }

        var scene = createScene();
        engine.runRenderLoop(function() {
            scene.render();
        });
        window.addEventListener("resize", function() {
            engine.resize();
        });

        </script>
    </body>
</html>